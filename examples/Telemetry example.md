# Telemetry Examples

This document provides an example of how to use the `flockserve` library to send telemetry data to an OpenTelemetry
collector.
[OpenTelemetry Collector](https://opentelemetry.io/docs/collector/) provides a vendor-agnostic implementation on how to
receive, process, and export telemetry data. It is a powerful tool that can be used to collect and process telemetry
data from various sources and export it to various destinations.

In this example we will be configuring OTEL collector to send telemetry to GCP but you can modify the provided OTEL
collector configuration file to send the collected data any backend you would like including AWS, Azure Monitors,
Grafana etc. Please check vendors documentation to do the configuration specific to vendors.

## OTEL Collector with GCP Monitors

> FlockServe emits Telemetry data by default, you just need a collector to collect it andd pass to a backend to be able to access it in real-time. In this example collector wil be OTEL collector and backend will be Google Monitors.

### Run OTEL Collector

- To run the collector with a custom configuration file, mount the directory containing custom configuration file and GCP Service Account file to the container using the `-v` flag. Required Roles for the Service Acc. can be found [here](https://cloud.google.com/stackdriver/docs/solutions/agents/ops-agent/otlp#grant-sa-trace)
- You have to set GCP project ID in custom configuration file.

```docker
docker pull otel/opentelemetry-collector-contrib:0.94.0
export GCP_SERVICE_ACC_KEY_FILE_NAME= # Set to name of you GCP service Acc. key file name
export ABS_PATH_TO_EXAMPLES=      # Set to Flockserve examples folder
docker run --rm -v $ABS_PATH_TO_EXAMPLES:/etc/otelcol-contrib/ --env GOOGLE_APPLICATION_CREDENTIALS=/etc/otelcol-contrib/$GCP_SERVICE_ACC_KEY_FILE_NAME -p 4317:4317 -p 4318:4318 --name otelcol otel/opentelemetry-collector-contrib:0.94.0
```


### Run FlockServe to send telemetry data to OTEL collector

- Run flockserve with following configuration which will send telemetry data to the local OTEL collector

```bash
flockserve --otel_collector_endpoint http://localhost:4317
```

**You should be able to see the metrics generated by the flockserve in the OTEL collector logs and also in the Google Monitoring.**


-------------------------------------

## Configure Google Cloud Ops Agent to collect Telemetry instead of OTEL collector

- If you are running the flockserve in GCP resources, you can make use of Google Ops Agent to collect the logs inste of
  running OTEL collector. You need to make
  sure [Google Ops agent](https://cloud.google.com/stackdriver/docs/solutions/agents/ops-agent/install-index) is
  installed and running. We provide a sample configuration file that you can use with ops-agent to get going easily.
- You need to Replace Abs_path_to_user_home with the actual absolute path to user home in `/examples/GCP_ops_agent_config.yaml` and paste its content to `/etc/google-cloud-ops-agent/config.yaml` in the GCP resource such as VM. Please check the [documentation](https://cloud.google.com/stackdriver/docs/solutions/agents/ops-agent) here to learn about more on GCP Ops Agent




# References
[OTEL collector - Other installation methods](https://opentelemetry.io/docs/collector/installation/)
